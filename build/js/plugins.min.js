/* mdtable
 * version: 0.0.1
 * build: 2014-12-11 
 */
!function(a){a.fn.mdtable=function(b){var c=this;b=a.extend(!0,{},a.fn.mdtable.defaults,b);var d={checkbox:{th:'<th width="38" class="check"><label class="checkbox-primary"></label></th>',td:'<td class="check"><label class="checkbox-primary"></label></td>'},error:'<tr><td class="mdtable-error" colspan="'+(b.columns.length+(b.multicheck?1:0))+'">'+b.message.error+"</td></tr>",empty:'<tr><td class="mdtable-empty" colspan="'+(b.columns.length+(b.multicheck?1:0))+'">'+b.message.empty+"</td></tr>",timeout:'<tr><td class="mdtable-timeout" colspan="'+(b.columns.length+(b.multicheck?1:0))+'">'+b.message.timeout+"</td></tr>",paging:'<nav class="pull-right"><ul class="pagination"><li class="first hidden"><a class="disabled" data-page="f">'+b.paging.firstText+'</a></li><li class="pre"><a class="disabled" data-page="p">'+b.paging.preText+'</a></li><li class="page"><a data-page="1">1</a></li><li class="next"><a class="disabled" data-page="n">'+b.paging.nextText+'</a></li><li class="last hidden"><a class="disabled" data-page="l">'+b.paging.lastText+"</a></li></ul></nav>"},e=b.extra,f=-1,g=!1;this.wrap('<div class="'+b.wrapClass+' md-table-wrap"></div>').after(d.paging);var h=c.parent(),i=this.find("thead"),j=this.find("tbody");j.length||(i.after("<tbody></tbody>"),j=this.find("tbody"));for(var k=0;k<b.columns.length;k++){var l=b.columns[k],m=i.find("th,td").eq(k);l.sort&&l.sort.enable&&(!g&&l.sort["default"]?("asc"===l.sort["default"]?m.addClass("sorting_asc"):"desc"===l.sort["default"]&&m.addClass("sorting_desc"),f=k,g=!0,l.sort.rule&&m.data("rule",l.sort.rule)):m.addClass("sorting"),m.on("click",function(){var b=a(this),c=i.find("th:not(.check)").index(b),d=b.data("rule");b.hasClass("sorting_desc")?(w(c,"asc",d),b.removeClass("sorting_desc").addClass("sorting_asc")):(w(c,"desc",d),b.removeClass("sorting sorting_asc").addClass("sorting_desc")),b.siblings().filter(".sorting,.sorting_asc,.sorting_desc").removeClass("sorting_asc sorting_desc").addClass("sorting")}))}c.on("load.ok",function(){}).on("load.error",function(){});var n=1,o=0,p=0,q=b.paging.limit,r=1,s=1,t=c.next().find(".pagination").hide(),u={first:t.find("li.first"),first_a:t.find("li.first a"),pre:t.find("li.pre"),pre_a:t.find("li.pre a"),page:t.find("li.page"),next:t.find("li.next"),next_a:t.find("li.next a"),last:t.find("li.last"),last_a:t.find("li.last a")};if(c.on("page.change",function(){t.find("li.page a").eq(r-1).addClass("active"),1===r?u.pre_a.addClass("disabled"):u.pre_a.removeClass("disabled"),r===n?u.next_a.addClass("disabled"):u.next_a.removeClass("disabled"),c.find(".checkbox-primary").removeClass("checked")}),t.delegate("li a:not(.disabled,.active)","click",function(){var b=a(this),c=(b.parent(),b.data("page"));"f"===c?(p=0,s=0):"p"===c?(p-=q,s--):"n"===c?(p+=q,s++):"l"===c?(p=(n-1)*q,s=n):(c=parseInt(c),p=(c-1)*q,s=c),x(e)}),b.multicheck.enable){i.find("tr").prepend(d.checkbox.th);var v=i.find(".checkbox-primary");this.delegate(".checkbox-primary","click",function(){var b=a(this),d=j.find(".checkbox-primary");b.toggleClass("checked"),b.closest("thead").length>0?b.hasClass("checked")?d.addClass("checked"):d.removeClass("checked"):d.filter(".checked").length===d.length?v.addClass("checked"):v.removeClass("checked");var e=[],f=d.filter(".checked");f.each(function(a,b){e.push(d.index(b))}),c.trigger("select.change",[e])})}var w=function(b,c,d){(0==b||b)&&((d=null)&&(d=c,c=null),c||(c="asc"),j.append(j.children().sort(function(e,f){return e=a(e).find("td:not(.check)").eq(b),f=a(f).find("td:not(.check)").eq(b),d&&"function"==typeof d?d(e,f)*("desc"===c?-1:1):e.text().localeCompare(f.text())*("desc"===c?-1:1)})))},x=function(f){var g=a.extend({},f,{start:p,limit:q});e=f?f:e,a.load({url:f&&f.url?f.url:b.url,data:g,target:h,cache:b.cache?b.cache:!1,success:function(a){y(a)},error:function(a,b){j.empty().append("timeout"===b?d.timeout:d.error),c.trigger("load.error")}})},y=function(e){if(e.data){if(j.empty(),e.count>q){t.show(),o=e.count,n=Math.ceil(o/q),r=s,t.find("li.page").remove();for(var g=0;n>g;g++){{var h=u.page.clone();h.find("a").attr("data-page",g+1).text(g+1)}u.next.before(h)}c.trigger("page.change")}else t.hide();if(e=e.data,e.length){e.length>q&&(e.length=q);for(var g=0;g<e.length;g++){var k=a("<tr></tr>").addClass(g%2==0?"odd":"even");b.multicheck.enable&&k.append(d.checkbox.td);for(var l=0;l<b.columns.length;l++){var m=b.columns[l],p=e[g][m.row];m.renderer&&"function"==typeof m.renderer&&(p=m.renderer(p,e[g],e)),p instanceof a?(p.wrap("<td"+(m["class"]?' class="'+m["class"]+'"':"")+"></td>"),p=p.parent()):p=a("<td"+(m["class"]?' class="'+m["class"]+'"':"")+">"+p+"</td>"),k.append(p)}b.trRenderer&&b.trRenderer(k),k.data("row",e[g]),j.append(k)}if(-1!=f){var v=i.find("th").eq(f),x=null;x=v.hasClass("sorting_desc")?"desc":"asc",w(f,x,v.data("rule"))}}else j.empty().append(d.empty)}else j.empty().append(d.error);c.trigger("load.ok")};return b.url?x(b.extra):b.data&&y(b.data),this.load=function(a){p=0,x(a)},this.loadData=function(a){p=0,y(a)},c},a.fn.mdtable.defaults={wrapClass:"table-responsive",message:{empty:"暂无数据",error:"数据请求出错",timeout:"请求超时"},cache:!1,multicheck:{enable:!1,callback:null},paging:{limit:10,firstText:"<<",lastText:">>",preText:"<",nextText:">"}},a.extend({load:function(b){b=a.extend({},a.loadDefaults,b);var c=a(b.target);b.beforeSend=function(){c.loading("show")},b.complete=function(){c.loading("hide")},a.ajax(b)},loadDefaults:{type:"get",timeout:6e3,target:window}}),a.fn.checkbox=function(){this.on("click",function(){a(this).toggleClass("checked")})},a.fn.loading=function(b){b=b||"show";var c=a(".md-mask").eq(parseInt(this.attr("data-loading")-1));if(0==c.length&&(c=a('<div class="md-mask"><div class="md-loading"><img src="images/loading.gif" alt="loading"/></div></div>'),a("body").append(c),this.attr("data-loading",a(".md-mask").length)),"show"===b){c.show();var d=c.find(".md-loading"),e=this.outerHeight(),f=this.outerWidth(),g=this.offset(),h=24,i=60;if(this[0]===window)c.css({top:0,left:0,width:f,height:e}).removeClass("hidden");else{var j=f>i?f:i,k=e>h?e:h;c.css({top:g.top,left:g.left,width:j,height:k}).removeClass("hidden")}return d.css("margin-top",(c.height()-d.height())/2),this}return"hide"===b?(c.hide(),this):void 0}}(jQuery);